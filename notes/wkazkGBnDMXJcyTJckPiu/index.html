<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="icon" href="/favicon.ico"/><title>Producer</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="Personal knowledge space"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="delta_maniac"/><meta name="twitter:creator" content="delta_maniac"/><meta property="og:title" content="Producer"/><meta property="og:description" content="Personal knowledge space"/><meta property="og:url" content="https://deltamaniac.github.io//notes/wkazkGBnDMXJcyTJckPiu/"/><meta property="og:type" content="article"/><meta property="article:published_time" content="10/17/2020"/><meta property="article:modified_time" content="10/17/2020"/><link rel="canonical" href="https://deltamaniac.github.io//notes/wkazkGBnDMXJcyTJckPiu/"/><meta name="next-head-count" content="17"/><link rel="preload" href="/_next/static/css/8e7b7e4bce421c0a.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8e7b7e4bce421c0a.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-3d209faeb64f2f97.js" defer=""></script><script src="/_next/static/chunks/framework-28c999baf2863c3d.js" defer=""></script><script src="/_next/static/chunks/main-104451f3d1a5c4bc.js" defer=""></script><script src="/_next/static/chunks/pages/_app-9d8e0603730b15a3.js" defer=""></script><script src="/_next/static/chunks/935-4dee79e80b8641c6.js" defer=""></script><script src="/_next/static/chunks/6-50972def09142ee2.js" defer=""></script><script src="/_next/static/chunks/pages/notes/%5Bid%5D-78d472fa3b924116.js" defer=""></script><script src="/_next/static/uwaFLQSct0mTPwxN4Nqr7/_buildManifest.js" defer=""></script><script src="/_next/static/uwaFLQSct0mTPwxN4Nqr7/_ssgManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><section class="ant-layout" style="width:100%;min-height:100%"><header class="ant-layout-header" style="position:fixed;isolation:isolate;z-index:1;width:100%;border-bottom:1px solid #d4dadf;height:64px;padding:0 24px 0 2px"><div class="ant-row ant-row-center" style="max-width:992px;justify-content:space-between;margin:0 auto"><div style="display:flex" class="ant-col ant-col-xs-20 ant-col-sm-4"></div><div class="ant-col gutter-row ant-col-xs-0 ant-col-sm-20 ant-col-md-20 ant-col-lg-19"><div class="ant-select ant-select-lg ant-select-auto-complete ant-select-single ant-select-allow-clear ant-select-show-search" style="width:100%"><div class="ant-select-selector"><span class="ant-select-selection-search"><input type="search" autoComplete="off" class="ant-select-selection-search-input" role="combobox" aria-haspopup="listbox" aria-owns="undefined_list" aria-autocomplete="list" aria-controls="undefined_list" aria-activedescendant="undefined_list_0" value=""/></span><span class="ant-select-selection-placeholder">For full text search please use the &#x27;?&#x27; prefix. e.g. ? Onboarding</span></div></div></div><div style="display:none;align-items:center;justify-content:center" class="ant-col ant-col-xs-4 ant-col-sm-4 ant-col-md-0 ant-col-lg-0"><span role="img" aria-label="menu" style="font-size:24px" tabindex="-1" class="anticon anticon-menu"><svg viewBox="64 64 896 896" focusable="false" data-icon="menu" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></span></div></div></header><section class="ant-layout" style="margin-top:64px;display:flex;flex-direction:row"><div class="site-layout-sidebar" style="flex:0 0 auto;width:calc(max((100% - 992px) / 2, 0px) + 200px);min-width:200px;padding-left:calc((100% - 992px) / 2)"><aside class="ant-layout-sider ant-layout-sider-dark" style="position:fixed;overflow:auto;height:calc(100vh - 64px);background-color:transparent;flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"></div></aside></div><main class="ant-layout-content side-layout-main" style="max-width:1200px;min-width:0;display:block"><div style="padding:0 24px"><div class="main-content" role="main"><div class="ant-row"><div class="ant-col ant-col-24"><div class="ant-row" style="margin-left:-10px;margin-right:-10px"><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-24 ant-col-md-18"><div><h1 id="producer">Producer<a aria-hidden="true" class="anchor-heading icon-link" href="#producer"></a></h1>
<h2 id="producer-1">Producer<a aria-hidden="true" class="anchor-heading icon-link" href="#producer-1"></a></h2>
<p>Kafka has a binary wire protocol.This means that it is possible for applications to read messages from Kafka or write messages to Kafka simply by sending the correct byte sequences to Kafka’s network port.</p>
<p>Key Structure is <code>ProducerRecord</code></p>
<p><img src="/assets/images/2020-10-11-20-37-00.png"></p>
<h1 id="serializer">Serializer<a aria-hidden="true" class="anchor-heading icon-link" href="#serializer"></a></h1>
<p>Converts between wire format and code</p>
<p><a href="https://https://avro.apache.org/docs/current">Apache Avro</a>
Define a common schema for serialization and deserialization
Store in schema Registry
Store schema identifier in produced message
<img src="/assets/images/2020-10-11-20-37-15.png"></p>
<h1 id="creating-a-producer">Creating a Producer<a aria-hidden="true" class="anchor-heading icon-link" href="#creating-a-producer"></a></h1>
<h2 id="in-rust">In <a href="/notes/A6TBKYAcFVjBqZpdbHuaS">Rust</a><a aria-hidden="true" class="anchor-heading icon-link" href="#in-rust"></a></h2>
<p>Crate : <a href="https://crates.io/crates/kafka">kafka</a></p>
<pre class="language-rust"><code class="language-rust"><span class="token comment">// Producer Code</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span></span><span class="token class-name">Write</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>time<span class="token punctuation">::</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">kafka<span class="token punctuation">::</span>producer<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Producer</span><span class="token punctuation">,</span> <span class="token class-name">Record</span><span class="token punctuation">,</span> <span class="token class-name">RequiredAcks</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> <span class="token keyword">mut</span> producer <span class="token operator">=</span> <span class="token class-name">Producer</span><span class="token punctuation">::</span><span class="token function">from_hosts</span><span class="token punctuation">(</span><span class="token macro property">vec!</span><span class="token punctuation">(</span><span class="token string">"localhost:9092"</span><span class="token punctuation">.</span><span class="token function">to_owned</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">with_ack_timeout</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">from_secs</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">with_required_acks</span><span class="token punctuation">(</span><span class="token class-name">RequiredAcks</span><span class="token punctuation">::</span><span class="token class-name">One</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> <span class="token keyword">mut</span> buf <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span>with<span class="token operator">*</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span><span class="token number">10</span> <span class="token punctuation">{</span>
<span class="token keyword">let</span> <span class="token operator">*</span> <span class="token operator">=</span> <span class="token macro property">write!</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span><span class="token keyword">mut</span> buf<span class="token punctuation">,</span> <span class="token string">"{}"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// some computation of the message data to be sent</span>
producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span><span class="token class-name">Record</span><span class="token punctuation">::</span><span class="token function">from_value</span><span class="token punctuation">(</span><span class="token string">"my-topic"</span><span class="token punctuation">,</span> buf<span class="token punctuation">.</span><span class="token function">as_bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
buf<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Crate : <a href="https://crates.io/crates/rdkafka">rdkafka</a></p>
<pre class="language-rust"><code class="language-rust"> sync <span class="token keyword">fn</span> <span class="token function-definition function">produce</span><span class="token punctuation">(</span>brokers<span class="token punctuation">:</span> <span class="token operator">&#x26;</span><span class="token keyword">str</span><span class="token punctuation">,</span> topic_name<span class="token punctuation">:</span> <span class="token operator">&#x26;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> producer<span class="token punctuation">:</span> <span class="token operator">&#x26;</span><span class="token class-name">FutureProducer</span> <span class="token operator">=</span> <span class="token operator">&#x26;</span><span class="token class-name">ClientConfig</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"bootstrap.servers"</span><span class="token punctuation">,</span> brokers<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"message.timeout.ms"</span><span class="token punctuation">,</span> <span class="token string">"5000"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"Producer creation error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// This loop is non blocking: all messages will be sent one after the other, without waiting</span>
    <span class="token comment">// for the results.</span>
    <span class="token keyword">let</span> futures <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">5</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>i<span class="token closure-punctuation punctuation">|</span></span> <span class="token keyword">async</span> <span class="token keyword">move</span> <span class="token punctuation">{</span>
            <span class="token comment">// The send operation on the topic returns a future, which will be</span>
            <span class="token comment">// completed once the result or failure from Kafka is received.</span>
            <span class="token keyword">let</span> delivery_status <span class="token operator">=</span> producer
                <span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>
                    <span class="token class-name">FutureRecord</span><span class="token punctuation">::</span><span class="token function">to</span><span class="token punctuation">(</span>topic_name<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">payload</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span><span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"Message {}"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span><span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"Key {}"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">headers</span><span class="token punctuation">(</span><span class="token class-name">OwnedHeaders</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"header_key"</span><span class="token punctuation">,</span> <span class="token string">"header_value"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">from_secs</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">;</span>

            <span class="token comment">// This will be executed when the result is received.</span>
            <span class="token macro property">info!</span><span class="token punctuation">(</span><span class="token string">"Delivery status for message {} received"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            delivery_status
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">::</span><span class="token operator">&#x3C;</span><span class="token class-name">Vec</span><span class="token operator">&#x3C;</span>_<span class="token operator">>></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// This loop will wait until all delivery statuses have been received.</span>
    <span class="token keyword">for</span> future <span class="token keyword">in</span> futures <span class="token punctuation">{</span>
        <span class="token macro property">info!</span><span class="token punctuation">(</span><span class="token string">"Future completed. Result: {:?}"</span><span class="token punctuation">,</span> future<span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
<p>Schema Registry for confluent : <a href="https://github.com/gklijs/schema_registry_converter">https://github.com/gklijs/schema_registry_converter</a></p>
<p>Confluent Write up : <a href="https://www.confluent.io/blog/getting-started-with-rust-and-kafka/">https://www.confluent.io/blog/getting-started-with-rust-and-kafka/</a></p>
<hr>
<h2 id="in-go">In <a href="/notes/96Hj5nYpnUciwlTenFpoU">Go</a><a aria-hidden="true" class="anchor-heading icon-link" href="#in-go"></a></h2>
<p>Package : <a href="https://github.com/confluentinc/confluent-kafka-go">Confluent Inc</a></p>
<pre class="language-golang"><code class="language-golang">func main() {

	p, err := kafka.NewProducer(&#x26;kafka.ConfigMap{"bootstrap.servers": "localhost"})
	if err != nil {
		panic(err)
	}

	defer p.Close()

	// Delivery report handler for produced messages
	go func() {
		for e := range p.Events() {
			switch ev := e.(type) {
			case *kafka.Message:
				if ev.TopicPartition.Error != nil {
					fmt.Printf("Delivery failed: %v\n", ev.TopicPartition)
				} else {
					fmt.Printf("Delivered message to %v\n", ev.TopicPartition)
				}
			}
		}
	}()

	// Produce messages to topic (asynchronously)
	topic := "myTopic"
	for _, word := range []string{"Welcome", "to", "the", "Confluent", "Kafka", "Golang", "client"} {
		p.Produce(&#x26;kafka.Message{
			TopicPartition: kafka.TopicPartition{Topic: &#x26;topic, Partition: kafka.PartitionAny},
			Value:          []byte(word),
		}, nil)
	}

	// Wait for message deliveries before shutting down
	p.Flush(15 * 1000)
}
</code></pre>
<p>Package : <a href="https://github.com/segmentio/kafka-go">SegmentIO</a></p>
<pre class="language-golang"><code class="language-golang">func producer() {

    topic := "my-topic"
    partition := 0

    conn, _ := kafka.DialLeader(context.Background(), "tcp", "localhost:9092", topic, partition)

    conn.SetWriteDeadline(time.Now().Add(10*time.Second))
    conn.WriteMessages(
    kafka.Message{Value: []byte("one!")},
    kafka.Message{Value: []byte("two!")},
    kafka.Message{Value: []byte("three!")},
    )

    conn.Close()
}
</code></pre>
<p>Package : <a href="https://github.com/Shopify/sarama">Sarama</a></p>
<pre class="language-golang"><code class="language-golang">//Sync Producer
func newDataCollector(brokerList []string) sarama.SyncProducer {

	// For the data collector, we are looking for strong consistency semantics.
	// Because we don't change the flush settings, sarama will try to produce messages
	// as fast as possible to keep latency low.
	config := sarama.NewConfig()
	config.Producer.RequiredAcks = sarama.WaitForAll // Wait for all in-sync replicas to ack the message
	config.Producer.Retry.Max = 10                   // Retry up to 10 times to produce the message
	config.Producer.Return.Successes = true
	tlsConfig := createTlsConfiguration()
	if tlsConfig != nil {
		config.Net.TLS.Config = tlsConfig
		config.Net.TLS.Enable = true
	}

	// On the broker side, you may want to change the following settings to get
	// stronger consistency guarantees:
	// - For your broker, set `unclean.leader.election.enable` to false
	// - For the topic, you could increase `min.insync.replicas`.

	producer, err := sarama.NewSyncProducer(brokerList, config)
	if err != nil {
		log.Fatalln("Failed to start Sarama producer:", err)
	}

	return producer
}

// Async Producer
func newAccessLogProducer(brokerList []string) sarama.AsyncProducer {

	// For the access log, we are looking for AP semantics, with high throughput.
	// By creating batches of compressed messages, we reduce network I/O at a cost of more latency.
	config := sarama.NewConfig()
	tlsConfig := createTlsConfiguration()
	if tlsConfig != nil {
		config.Net.TLS.Enable = true
		config.Net.TLS.Config = tlsConfig
	}
	config.Producer.RequiredAcks = sarama.WaitForLocal       // Only wait for the leader to ack
	config.Producer.Compression = sarama.CompressionSnappy   // Compress messages
	config.Producer.Flush.Frequency = 500 * time.Millisecond // Flush batches every 500ms

	producer, err := sarama.NewAsyncProducer(brokerList, config)
	if err != nil {
		log.Fatalln("Failed to start Sarama producer:", err)
	}

	// We will just log to STDOUT if we're not able to produce messages.
	// Note: messages will only be returned here after all retry attempts are exhausted.
	go func() {
		for err := range producer.Errors() {
			log.Println("Failed to write access log entry:", err)
		}
	}()

	return producer
}

go func sendMessage(){
        // Synch
		partition, offset, err := s.DataCollector.SendMessage(&#x26;sarama.ProducerMessage{
			Topic: "important",
			Value: sarama.StringEncoder(r.URL.RawQuery),
        })
        // Async
        s.AccessLogProducer.Input() &#x3C;- &#x26;sarama.ProducerMessage{
			Topic: "access_log",
			Key:   sarama.StringEncoder(r.RemoteAddr),
			Value: entry,
		}
}
</code></pre>
<hr>
<strong>Backlinks</strong>
<ul>
<li><a href="/notes/96Hj5nYpnUciwlTenFpoU">Go</a></li>
<li><a href="/notes/6Wl0i0BjF7yD85uM5RTyK">Kafka</a></li>
<li><a href="/notes/A6TBKYAcFVjBqZpdbHuaS">Rust</a></li>
</ul></div></div><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-0 ant-col-md-6"><div><div class=""><div class="ant-anchor-wrapper dendron-toc" style="max-height:calc(100vh - 64px);z-index:1"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#producer" title="Producer">Producer</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#serializer" title="Serializer">Serializer</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#creating-a-producer" title="Creating a Producer">Creating a Producer</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#in" title="In">In</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#in-1" title="In">In</a></div></div></div></div></div></div></div></div></div></div></div><div class="ant-divider ant-divider-horizontal" role="separator"></div><footer class="ant-layout-footer" style="padding:0 24px 24px"></footer></main></section></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"note":{"id":"wkazkGBnDMXJcyTJckPiu","title":"Producer","desc":"","updated":1602919762613,"created":1602919762613,"stub":false,"custom":{"stub":false},"fname":"kafka.producer","type":"note","vault":{"fsPath":"vault"},"contentHash":"192db128de67ad7b7bf391409d84b731","links":[{"type":"wiki","from":{"fname":"kafka.producer","id":"wkazkGBnDMXJcyTJckPiu","vaultName":"vault"},"value":"rust","position":{"start":{"line":21,"column":7,"offset":617},"end":{"line":21,"column":15,"offset":625},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"rust"}},{"type":"wiki","from":{"fname":"kafka.producer","id":"wkazkGBnDMXJcyTJckPiu","vaultName":"vault"},"value":"go","position":{"start":{"line":91,"column":7,"offset":2842},"end":{"line":91,"column":13,"offset":2848},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"go"}},{"from":{"fname":"go","id":"96Hj5nYpnUciwlTenFpoU","vaultName":"vault"},"type":"backlink","position":{"start":{"line":5,"column":1,"offset":17},"end":{"line":5,"column":28,"offset":44},"indent":[]},"value":"kafka.producer"},{"from":{"fname":"kafka","id":"6Wl0i0BjF7yD85uM5RTyK","vaultName":"vault"},"type":"backlink","position":{"start":{"line":21,"column":3,"offset":631},"end":{"line":21,"column":30,"offset":658},"indent":[]},"value":"kafka.producer"},{"from":{"fname":"rust","id":"A6TBKYAcFVjBqZpdbHuaS","vaultName":"vault"},"type":"backlink","position":{"start":{"line":9,"column":1,"offset":65},"end":{"line":9,"column":28,"offset":92},"indent":[]},"value":"kafka.producer"}],"anchors":{"producer":{"type":"header","text":"Producer","value":"producer","line":8,"column":0,"depth":2},"serializer":{"type":"header","text":"Serializer","value":"serializer","line":16,"column":0,"depth":1},"creating-a-producer":{"type":"header","text":"Creating a Producer","value":"creating-a-producer","line":26,"column":0,"depth":1},"in":{"type":"header","text":"In","value":"in","line":28,"column":0,"depth":2},"in-1":{"type":"header","text":"In","value":"in-1","line":98,"column":0,"depth":2}},"children":[],"parent":"6Wl0i0BjF7yD85uM5RTyK","data":{}},"body":"\u003ch1 id=\"producer\"\u003eProducer\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#producer\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003ch2 id=\"producer-1\"\u003eProducer\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#producer-1\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eKafka has a binary wire protocol.This means that it is possible for applications to read messages from Kafka or write messages to Kafka simply by sending the correct byte sequences to Kafka’s network port.\u003c/p\u003e\n\u003cp\u003eKey Structure is \u003ccode\u003eProducerRecord\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/images/2020-10-11-20-37-00.png\"\u003e\u003c/p\u003e\n\u003ch1 id=\"serializer\"\u003eSerializer\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#serializer\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cp\u003eConverts between wire format and code\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://https://avro.apache.org/docs/current\"\u003eApache Avro\u003c/a\u003e\nDefine a common schema for serialization and deserialization\nStore in schema Registry\nStore schema identifier in produced message\n\u003cimg src=\"/assets/images/2020-10-11-20-37-15.png\"\u003e\u003c/p\u003e\n\u003ch1 id=\"creating-a-producer\"\u003eCreating a Producer\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#creating-a-producer\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003ch2 id=\"in-rust\"\u003eIn \u003ca href=\"/notes/A6TBKYAcFVjBqZpdbHuaS\"\u003eRust\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#in-rust\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eCrate : \u003ca href=\"https://crates.io/crates/kafka\"\u003ekafka\u003c/a\u003e\u003c/p\u003e\n\u003cpre class=\"language-rust\"\u003e\u003ccode class=\"language-rust\"\u003e\u003cspan class=\"token comment\"\u003e// Producer Code\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003euse\u003c/span\u003e \u003cspan class=\"token namespace\"\u003estd\u003cspan class=\"token punctuation\"\u003e::\u003c/span\u003efmt\u003cspan class=\"token punctuation\"\u003e::\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eWrite\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003euse\u003c/span\u003e \u003cspan class=\"token namespace\"\u003estd\u003cspan class=\"token punctuation\"\u003e::\u003c/span\u003etime\u003cspan class=\"token punctuation\"\u003e::\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eDuration\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003euse\u003c/span\u003e \u003cspan class=\"token namespace\"\u003ekafka\u003cspan class=\"token punctuation\"\u003e::\u003c/span\u003eproducer\u003cspan class=\"token punctuation\"\u003e::\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eProducer\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eRecord\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eRequiredAcks\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e \u003cspan class=\"token keyword\"\u003emut\u003c/span\u003e producer \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eProducer\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e::\u003c/span\u003e\u003cspan class=\"token function\"\u003efrom_hosts\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token macro property\"\u003evec!\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"localhost:9092\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eto_owned\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ewith_ack_timeout\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eDuration\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e::\u003c/span\u003e\u003cspan class=\"token function\"\u003efrom_secs\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ewith_required_acks\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eRequiredAcks\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e::\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eOne\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ecreate\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eunwrap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e \u003cspan class=\"token keyword\"\u003emut\u003c/span\u003e buf \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e::\u003c/span\u003ewith\u003cspan class=\"token operator\"\u003e*\u003c/span\u003e\u003cspan class=\"token function\"\u003ecapacity\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e i \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e..\u003c/span\u003e\u003cspan class=\"token number\"\u003e10\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token macro property\"\u003ewrite!\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003emut\u003c/span\u003e buf\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"{}\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e i\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// some computation of the message data to be sent\u003c/span\u003e\nproducer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003esend\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eRecord\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e::\u003c/span\u003e\u003cspan class=\"token function\"\u003efrom_value\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"my-topic\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e buf\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eas_bytes\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eunwrap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\nbuf\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eclear\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eCrate : \u003ca href=\"https://crates.io/crates/rdkafka\"\u003erdkafka\u003c/a\u003e\u003c/p\u003e\n\u003cpre class=\"language-rust\"\u003e\u003ccode class=\"language-rust\"\u003e sync \u003cspan class=\"token keyword\"\u003efn\u003c/span\u003e \u003cspan class=\"token function-definition function\"\u003eproduce\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ebrokers\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003estr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e topic_name\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003estr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e producer\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eFutureProducer\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eClientConfig\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e::\u003c/span\u003e\u003cspan class=\"token function\"\u003enew\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eset\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"bootstrap.servers\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e brokers\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eset\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"message.timeout.ms\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"5000\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ecreate\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eexpect\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Producer creation error\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token comment\"\u003e// This loop is non blocking: all messages will be sent one after the other, without waiting\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// for the results.\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e futures \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e..\u003c/span\u003e\u003cspan class=\"token number\"\u003e5\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003emap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token closure-params\"\u003e\u003cspan class=\"token closure-punctuation punctuation\"\u003e|\u003c/span\u003ei\u003cspan class=\"token closure-punctuation punctuation\"\u003e|\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token keyword\"\u003emove\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"token comment\"\u003e// The send operation on the topic returns a future, which will be\u003c/span\u003e\n            \u003cspan class=\"token comment\"\u003e// completed once the result or failure from Kafka is received.\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e delivery_status \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e producer\n                \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003esend\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n                    \u003cspan class=\"token class-name\"\u003eFutureRecord\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e::\u003c/span\u003e\u003cspan class=\"token function\"\u003eto\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etopic_name\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                        \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003epayload\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan class=\"token macro property\"\u003eformat!\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Message {}\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e i\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                        \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ekey\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan class=\"token macro property\"\u003eformat!\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Key {}\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e i\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                        \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eheaders\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eOwnedHeaders\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e::\u003c/span\u003e\u003cspan class=\"token function\"\u003enew\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eadd\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"header_key\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"header_value\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"token class-name\"\u003eDuration\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e::\u003c/span\u003e\u003cspan class=\"token function\"\u003efrom_secs\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"token comment\"\u003e// This will be executed when the result is received.\u003c/span\u003e\n            \u003cspan class=\"token macro property\"\u003einfo!\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Delivery status for message {} received\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e i\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n            delivery_status\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ecollect\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e::\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eVec\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e_\u003cspan class=\"token operator\"\u003e\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token comment\"\u003e// This loop will wait until all delivery statuses have been received.\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e future \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e futures \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token macro property\"\u003einfo!\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Future completed. Result: {:?}\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e future\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eSchema Registry for confluent : \u003ca href=\"https://github.com/gklijs/schema_registry_converter\"\u003ehttps://github.com/gklijs/schema_registry_converter\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eConfluent Write up : \u003ca href=\"https://www.confluent.io/blog/getting-started-with-rust-and-kafka/\"\u003ehttps://www.confluent.io/blog/getting-started-with-rust-and-kafka/\u003c/a\u003e\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"in-go\"\u003eIn \u003ca href=\"/notes/96Hj5nYpnUciwlTenFpoU\"\u003eGo\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#in-go\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003ePackage : \u003ca href=\"https://github.com/confluentinc/confluent-kafka-go\"\u003eConfluent Inc\u003c/a\u003e\u003c/p\u003e\n\u003cpre class=\"language-golang\"\u003e\u003ccode class=\"language-golang\"\u003efunc main() {\n\n\tp, err := kafka.NewProducer(\u0026#x26;kafka.ConfigMap{\"bootstrap.servers\": \"localhost\"})\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\n\tdefer p.Close()\n\n\t// Delivery report handler for produced messages\n\tgo func() {\n\t\tfor e := range p.Events() {\n\t\t\tswitch ev := e.(type) {\n\t\t\tcase *kafka.Message:\n\t\t\t\tif ev.TopicPartition.Error != nil {\n\t\t\t\t\tfmt.Printf(\"Delivery failed: %v\\n\", ev.TopicPartition)\n\t\t\t\t} else {\n\t\t\t\t\tfmt.Printf(\"Delivered message to %v\\n\", ev.TopicPartition)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}()\n\n\t// Produce messages to topic (asynchronously)\n\ttopic := \"myTopic\"\n\tfor _, word := range []string{\"Welcome\", \"to\", \"the\", \"Confluent\", \"Kafka\", \"Golang\", \"client\"} {\n\t\tp.Produce(\u0026#x26;kafka.Message{\n\t\t\tTopicPartition: kafka.TopicPartition{Topic: \u0026#x26;topic, Partition: kafka.PartitionAny},\n\t\t\tValue:          []byte(word),\n\t\t}, nil)\n\t}\n\n\t// Wait for message deliveries before shutting down\n\tp.Flush(15 * 1000)\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ePackage : \u003ca href=\"https://github.com/segmentio/kafka-go\"\u003eSegmentIO\u003c/a\u003e\u003c/p\u003e\n\u003cpre class=\"language-golang\"\u003e\u003ccode class=\"language-golang\"\u003efunc producer() {\n\n    topic := \"my-topic\"\n    partition := 0\n\n    conn, _ := kafka.DialLeader(context.Background(), \"tcp\", \"localhost:9092\", topic, partition)\n\n    conn.SetWriteDeadline(time.Now().Add(10*time.Second))\n    conn.WriteMessages(\n    kafka.Message{Value: []byte(\"one!\")},\n    kafka.Message{Value: []byte(\"two!\")},\n    kafka.Message{Value: []byte(\"three!\")},\n    )\n\n    conn.Close()\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ePackage : \u003ca href=\"https://github.com/Shopify/sarama\"\u003eSarama\u003c/a\u003e\u003c/p\u003e\n\u003cpre class=\"language-golang\"\u003e\u003ccode class=\"language-golang\"\u003e//Sync Producer\nfunc newDataCollector(brokerList []string) sarama.SyncProducer {\n\n\t// For the data collector, we are looking for strong consistency semantics.\n\t// Because we don't change the flush settings, sarama will try to produce messages\n\t// as fast as possible to keep latency low.\n\tconfig := sarama.NewConfig()\n\tconfig.Producer.RequiredAcks = sarama.WaitForAll // Wait for all in-sync replicas to ack the message\n\tconfig.Producer.Retry.Max = 10                   // Retry up to 10 times to produce the message\n\tconfig.Producer.Return.Successes = true\n\ttlsConfig := createTlsConfiguration()\n\tif tlsConfig != nil {\n\t\tconfig.Net.TLS.Config = tlsConfig\n\t\tconfig.Net.TLS.Enable = true\n\t}\n\n\t// On the broker side, you may want to change the following settings to get\n\t// stronger consistency guarantees:\n\t// - For your broker, set `unclean.leader.election.enable` to false\n\t// - For the topic, you could increase `min.insync.replicas`.\n\n\tproducer, err := sarama.NewSyncProducer(brokerList, config)\n\tif err != nil {\n\t\tlog.Fatalln(\"Failed to start Sarama producer:\", err)\n\t}\n\n\treturn producer\n}\n\n// Async Producer\nfunc newAccessLogProducer(brokerList []string) sarama.AsyncProducer {\n\n\t// For the access log, we are looking for AP semantics, with high throughput.\n\t// By creating batches of compressed messages, we reduce network I/O at a cost of more latency.\n\tconfig := sarama.NewConfig()\n\ttlsConfig := createTlsConfiguration()\n\tif tlsConfig != nil {\n\t\tconfig.Net.TLS.Enable = true\n\t\tconfig.Net.TLS.Config = tlsConfig\n\t}\n\tconfig.Producer.RequiredAcks = sarama.WaitForLocal       // Only wait for the leader to ack\n\tconfig.Producer.Compression = sarama.CompressionSnappy   // Compress messages\n\tconfig.Producer.Flush.Frequency = 500 * time.Millisecond // Flush batches every 500ms\n\n\tproducer, err := sarama.NewAsyncProducer(brokerList, config)\n\tif err != nil {\n\t\tlog.Fatalln(\"Failed to start Sarama producer:\", err)\n\t}\n\n\t// We will just log to STDOUT if we're not able to produce messages.\n\t// Note: messages will only be returned here after all retry attempts are exhausted.\n\tgo func() {\n\t\tfor err := range producer.Errors() {\n\t\t\tlog.Println(\"Failed to write access log entry:\", err)\n\t\t}\n\t}()\n\n\treturn producer\n}\n\ngo func sendMessage(){\n        // Synch\n\t\tpartition, offset, err := s.DataCollector.SendMessage(\u0026#x26;sarama.ProducerMessage{\n\t\t\tTopic: \"important\",\n\t\t\tValue: sarama.StringEncoder(r.URL.RawQuery),\n        })\n        // Async\n        s.AccessLogProducer.Input() \u0026#x3C;- \u0026#x26;sarama.ProducerMessage{\n\t\t\tTopic: \"access_log\",\n\t\t\tKey:   sarama.StringEncoder(r.RemoteAddr),\n\t\t\tValue: entry,\n\t\t}\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003chr\u003e\n\u003cstrong\u003eBacklinks\u003c/strong\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"/notes/96Hj5nYpnUciwlTenFpoU\"\u003eGo\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"/notes/6Wl0i0BjF7yD85uM5RTyK\"\u003eKafka\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"/notes/A6TBKYAcFVjBqZpdbHuaS\"\u003eRust\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e","noteIndex":{"id":"root","title":"BrainMatter","desc":"","updated":1668313955403,"created":1602915435296,"stub":false,"nav_order":0,"custom":{"stub":false,"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":"vault"},"contentHash":"7b584540f5ff09a7953c66d95b7ee329","links":[],"anchors":{},"children":["ovOjtfOpF3vhfFUZi6DHp","3dNch4I3rcDy5xXFn3R6B","BWzIJm01jQ6aNNg56CwnS","96Hj5nYpnUciwlTenFpoU","6Wl0i0BjF7yD85uM5RTyK","o3yahkxofd7qighsrvpg893","7kyCk8YAkDvIrxLtAUFkG","A6TBKYAcFVjBqZpdbHuaS","w3B0c1Y72MfzhwoVNx7vx","t6ilpq115sipjv378ambtkv"],"parent":null,"data":{},"body":"\n\n![DeltaManiac](https://raw.githubusercontent.com/DeltaManiac/DeltaManiac/main/vault/assets/banner.svg)\n\n- 🔭 I’m currently playing Destiny 2\n- 🌱 I’m currently learning [Rust](https://www.rust-lang.org) at night and [Go](https://golang.org/) at work\n- 📫 How to reach me: [twitter](https://twitter.com/Delta_Maniac)\n- 😄 Pronouns: He/Him\n\u003c!-- - ⚡ Fun fact: The banner was provided by [Pushkar Anand](https://github.com/pushkar8723) sourced from [Responsive Cow Jumps Over the Moooooon](https://codepen.io/sdras/pen/doZReX) --\u003e\n\u003c!-- // - 👯 I’m looking to collaborate on ...\n// - 🤔 I’m looking for help with ...\n// - 💬 Ask me about ... --\u003e\n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":false,"leaveTrace":false,"bubbleUpCreateNew":true,"vaultSelectionModeOnCreate":"smart","fuzzThreshold":0.2}},"randomNote":{},"insertNote":{"initialValue":"templates"},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"copyNoteLink":{"aliasMode":"title"},"templateHierarchy":"template"},"workspace":{"dendronVersion":"0.83.0","vaults":[{"fsPath":"vault"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":true,"maxPreviewsCached":10,"maxNoteLength":204800,"task":{"name":"","dateFormat":"","addBehavior":"childOfCurrent","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link","taskCompleteStatus":["done","x"]},"enableUserTags":true,"enableHashTags":true,"enableEditorDecorations":true,"enableFullHierarchyNoteTitle":false},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"automaticallyShowPreview":false},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["root"],"writeStubs":true,"siteRootDir":"docs","seo":{"title":"BrainMatter","description":"Personal knowledge space","author":"DeltaManiac","twitter":"delta_maniac"},"github":{"enableEditLink":true,"editLinkText":"Edit this page on GitHub","editBranch":"main","editViewMode":"tree","editRepository":"https://github.com/DeltaManiac/deltamaniac.github.io"},"enableSiteLastModified":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"enableTaskNotes":true,"enablePrettyLinks":true,"searchMode":"lookup","siteUrl":"https://deltamaniac.github.io/","hierarchy":{"root":{"publishByDefault":true}},"siteFaviconPath":"favicon.ico","siteIndex":"root"},"generateChangelog":true}},"__N_SSG":true},"page":"/notes/[id]","query":{"id":"wkazkGBnDMXJcyTJckPiu"},"buildId":"uwaFLQSct0mTPwxN4Nqr7","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>